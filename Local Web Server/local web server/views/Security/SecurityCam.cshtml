@using Local_Web_Server.Models;
@model Local_Web_Server.Models.Security
@{
    ViewBag.Title = "Security";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    $(document).ready(function () {
        $("iframe").each(function () {
            $(this).attr('height', $(window).height() - $(".navbar").height() - $(".tr-header").height());
        });
        $(".delete").click(function (event) {
            var Id = event.target.id;
            $(".modal-body").attr('id', (Id));
        });
    });

    function Delete() {
        var _id = $(".modal-body").attr('id');
        $.ajax({
            type: "POST",
            url: '@Url.Action("deleteCamera", "Security")',
            contentType: "application/json",
            data: JSON.stringify({ id: _id }),
            dataType: "json",
            success: function () {
                swal("Success!", "Content Deleted!", "success");
                setTimeout("window.location.href = '@Url.Content("~/Security/SecurityCam/")'", 1000);
            },
            error: function () { sweetAlert("Error Son", "Something went wrong!", "error"); }
        });
    }

    function Create() {
        var address = $("#address").val();
        var location = $("#location").val();
        if (address.length != 0 && location.length != 0) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("addCamera", "Security")',
                contentType: "application/json",
                data: JSON.stringify({ _address: address, _location: location }),
                dataType: "json",
                success: function () {
                    swal("Success!", "IP Address Added!", "success");
                    setTimeout("window.location.href = '@Url.Content("~/Security/SecurityCam/")'", 1000);
                },
                error: function () { sweetAlert("Error Son", "Something went wrong!", "error"); }
            });
        }
        else
        {
            swal("All fields required", "", "error")
        }
    }
</script>

<h2>Security Cameras</h2>
@Html.EditorFor(model => model.Address, new { htmlAttributes = new { @class = "form-control", @maxlength = "50", @placeholder = "IP Address", @id = "address" } })
@Html.EditorFor(model => model.Location, new { htmlAttributes = new { @class = "form-control", @maxlength = "20", @placeholder = "Location", @id = "location" } })
<button type="button" onclick="Create()" class="btn btn-lg btn-success">Create</button>

@{
    Security s = new Security();
    List<Security> cams = new List<Security>();
    cams = s.getCameras();
    if (cams.Count != null)
    {
        <table style="width:100%; height:100%;">
            @foreach (var item in cams)
            {
                <tr style="height:100%;" class="tr-header">
                    <td>
                        @item.Owner
                    </td>
                    <td>
                        @item.Location
                    </td>
                    <td align="right"><button class="btn btn-danger delete" data-toggle="modal" data-target="#myModal" id="@item.Id"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button></td>
                </tr>
                <tr style="height:100%;">
                    <td colspan="3">
                        @{
                            string addr = item.Address;
                            if (item.Address.IndexOf("http://") != -1)
                            {
                                <iframe src="@addr" id="@item.Id" scrolling="auto" style="width:100%;"></iframe>
                            }
                            else
                            {
                                addr = "http://" + item.Address;
                                <iframe src="@addr" id="@item.Id" scrolling="auto" style="width:100%;"></iframe>
                            }
                        }
                    </td>
                </tr>
            }
        </table>
    }
}
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">A wild verification window appears!</h4>
            </div>
            <div class="modal-body" id="">
                Are you sure you want to delete this?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Nope Nope Nope</button>
                <button type="button" class="btn btn-danger" onclick="Delete()" data-dismiss="modal">Delete</button>
            </div>
        </div>
    </div>
</div>